<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø®ØµÙŠØ©</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f2f5f8;
      padding: 20px;
      direction: rtl;
      text-align: right;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background-color: #27ae60;
      color: white;
      padding: 10px;
      width: 100%;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      margin-top: 15px;
      cursor: pointer;
    }
    button:hover {
      background-color: #219150;
    }
    .result, .summary {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
      color: #34495e;
      text-align: center;
    }
    .expenses-list {
      margin-top: 10px;
      font-size: 15px;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
    }
    hr {
      border: 1px dashed #ccc;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h1>
  <div class="container">

    <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <label for="salary">ğŸ’° Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
    <input type="number" id="salary" placeholder="Ù…Ø«Ø§Ù„: 700" />


    <!-- <label for="extra">ğŸ’¼ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</label>
    <input type="number" id="extra" placeholder="Ù…Ø«Ø§Ù„: 150" /> -->

    <label for="expenses">ğŸ“‹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</label>
    <input type="number" id="expenses" placeholder="Ù…Ø«Ø§Ù„: 300" />



    <button onclick="calculate()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
    <div class="result" id="result"></div>

    <!-- Ø¥Ø¯Ø®Ø§Ù„ Ù…ØµØ±ÙˆÙ ÙŠÙˆÙ…ÙŠ -->
    <hr />

    <label for="extra-today">ğŸ’¼ Ø¯Ø®Ù„ Ø¥Ø¶Ø§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</label>
<input type="number" id="extra-today" placeholder="Ù…Ø«Ø§Ù„: 5" />
<button onclick="addExtra()">Ø£Ø¶Ù Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</button>

    <label for="daily-expense">ğŸ’¸ Ø£Ø¶Ù Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…</label>
    <input type="number" id="daily-expense" placeholder="Ù…Ø«Ø§Ù„: 20" />
    <button onclick="addExpense()">Ø£Ø¶Ù Ø§Ù„Ù…ØµØ±ÙˆÙ</button>

    <div class="summary" id="remaining"></div>

    <!-- Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
    <div class="expenses-list" id="expense-list"></div>

    <div class="expenses-list" id="stats"></div>


    <small>Ø³ÙŠØªÙ… Ø®ØµÙ… Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ù…ØµØ±ÙˆÙÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ ÙˆØªÙˆÙÙŠØ±Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</small>


    <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© -->
    <button style="background-color: #e74c3c;" onclick="resetData()">â™»ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

  </div>

  <script>
function calculate() {
  const salary = parseFloat(document.getElementById("salary").value) || 0;
  const expenses = parseFloat(document.getElementById("expenses").value) || 0;
const goal = parseFloat(document.getElementById("monthly-goal").value) || 0;
localStorage.setItem("saving_goal", goal);

  const totalIncome = salary;
  const netBeforeSaving = totalIncome - expenses;

  let savingPercent = 0;
  if (netBeforeSaving < 100) savingPercent = 5;
  else if (netBeforeSaving < 200) savingPercent = 10;
  else if (netBeforeSaving < 400) savingPercent = 15;
  else savingPercent = 20;

  const savingAmount = (totalIncome * savingPercent / 100);
  const net = totalIncome - expenses - savingAmount;
  const daily = (net / 30).toFixed(2);

  localStorage.setItem("daily_limit", daily);
  localStorage.setItem("carry", "0");
  localStorage.setItem("expenses", JSON.stringify([]));
  localStorage.setItem("extra_income", JSON.stringify({})); // Reset daily extras
  localStorage.setItem("last_date", new Date().toLocaleDateString());
  localStorage.setItem("saving_plan", savingAmount.toFixed(2));
  localStorage.setItem("saving_percent", savingPercent);


  


  updateUI();
}


function addExtra() {
  const amount = parseFloat(document.getElementById("extra-today").value);
  if (!amount || amount <= 0) return;

  const today = new Date().toLocaleDateString();
  let extras = JSON.parse(localStorage.getItem("extra_income")) || {};
  extras[today] = (extras[today] || 0) + amount;
  localStorage.setItem("extra_income", JSON.stringify(extras));

  document.getElementById("extra-today").value = "";
  updateUI();
}




    function addExpense() {
      const amount = parseFloat(document.getElementById("daily-expense").value);
      if (!amount || amount <= 0) return;

      const today = new Date().toLocaleDateString();
      let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
      expenses.push({ amount, date: today });
      localStorage.setItem("expenses", JSON.stringify(expenses));

      document.getElementById("daily-expense").value = "";
      updateUI();
    }

    function updateUI() {
      const today = new Date().toLocaleDateString();
      const lastDate = localStorage.getItem("last_date");
      const dailyLimit = parseFloat(localStorage.getItem("daily_limit")) || 0;
      let carry = parseFloat(localStorage.getItem("carry")) || 0;
      let extras = JSON.parse(localStorage.getItem("extra_income")) || {};
const extraToday = extras[today] || 0;


const baseSaving = parseFloat(localStorage.getItem("saving_plan")) || 0;
const dynamicSaving = (extraToday * (parseFloat(localStorage.getItem("saving_percent")) || 0) / 100).toFixed(2);
const totalSaving = (baseSaving / 30 + parseFloat(dynamicSaving)).toFixed(2);
const savingPercent = localStorage.getItem("saving_percent") || 0;


      let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

      // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØºÙŠÙŠØ± Ø§Ù„ÙŠÙˆÙ… Ù„ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯
      if (lastDate && lastDate !== today) {
        const yesterdayExpenses = expenses.filter(e => e.date === lastDate);
        const spentYesterday = yesterdayExpenses.reduce((sum, e) => sum + e.amount, 0);
        const saved = Math.max(dailyLimit - spentYesterday, 0);
        carry += saved;
        localStorage.setItem("carry", carry.toFixed(2));
        localStorage.setItem("last_date", today);
      }

      const todayExpenses = expenses.filter(e => e.date === today);
      const totalSpentToday = todayExpenses.reduce((sum, e) => sum + e.amount, 0);
const effectiveLimit = (dailyLimit + carry + extraToday).toFixed(2);
      const remainingToday = (effectiveLimit - totalSpentToday).toFixed(2);

document.getElementById("result").innerHTML = `
âœ… Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„ÙŠÙˆÙ…: ${effectiveLimit} Ø¯ÙŠÙ†Ø§Ø± (Ø¨Ù…Ø§ ÙÙŠÙ‡ Ø§Ù„Ù…Ø±Ø­Ù„ + Ø¯Ø®Ù„ Ø¥Ø¶Ø§ÙÙŠ ${extraToday})<br>
ğŸ¦ Ø®Ø·Ø© Ø§Ù„ØªÙˆÙÙŠØ± (${savingPercent}%): ${baseSaving} Ù…Ù† Ø§Ù„Ø±Ø§ØªØ¨ + ${dynamicSaving} Ù…Ù† Ø¯Ø®Ù„ Ø§Ù„ÙŠÙˆÙ…<br>
ğŸ“‰ ØªÙ… Ø®ØµÙ… ${totalSaving} Ø¯ÙŠÙ†Ø§Ø± Ù…Ù† Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù„Ù„ØªÙˆÙÙŠØ±
`;

      document.getElementById("remaining").innerText = `ğŸ’° Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ÙŠÙˆÙ…: ${remainingToday} Ø¯ÙŠÙ†Ø§Ø±`;

      // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ
let alertMessage = "";
if (remainingToday < 0) {
  alertMessage = `âš ï¸ Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ù…Ù‚Ø¯Ø§Ø± ${Math.abs(remainingToday)} Ø¯ÙŠÙ†Ø§Ø±`;
} else if (remainingToday > 0) {
  alertMessage = `âœ… Ù…Ù…ØªØ§Ø²! ÙˆÙÙ‘Ø±Øª ${remainingToday} Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„ÙŠÙˆÙ…`;
}

document.getElementById("remaining").innerHTML += `<br>${alertMessage}`;


      // Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ù…ÙØµÙˆÙ„Ø© Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…
      const grouped = {};
      expenses.forEach(e => {
        if (!grouped[e.date]) grouped[e.date] = [];
        grouped[e.date].push(e.amount);
      });

let html = '';
Object.keys(grouped).sort((a, b) => {
  const da = new Date(a);
  const db = new Date(b);
  return db - da; // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
}).forEach(date => {
  const total = grouped[date].reduce((a, b) => a + b, 0).toFixed(2);
  html += `<hr><b>ğŸ“… ${date}</b><br>`;
  grouped[date].forEach((amt, i) => {
    html += `ğŸ§¾ Ù…ØµØ±ÙˆÙ ${i + 1}: -${amt} Ø¯ÙŠÙ†Ø§Ø±<br>`;
  });
  html += `ğŸ”¢ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ…: ${total} Ø¯ÙŠÙ†Ø§Ø±<br>`;
});


      // Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù„ÙƒÙ„ ÙŠÙˆÙ…
let extraHtml = "<hr><b>ğŸ’¼ Ø¯Ø®Ù„ Ø¥Ø¶Ø§ÙÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…:</b><br>";
for (let date in extras) {
  extraHtml += `ğŸ“… ${date}: +${extras[date].toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±<br>`;
}



document.getElementById("expense-list").innerHTML = extraHtml + html || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ø¹Ø¯.";

// ğŸ“Š Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø°ÙƒÙŠØ©
let allDates = new Set();
let totalSpent = 0;
let maxSpent = 0;
let maxSpentDate = "";
let daysWithExpenses = new Set();

for (let exp of allExpenses) {
  allDates.add(exp.date);
  totalSpent += exp.amount;
  if (!savingsMap[exp.date]) savingsMap[exp.date] = 0;
  savingsMap[exp.date] += exp.amount;
  if (savingsMap[exp.date] > maxSpent) {
    maxSpent = savingsMap[exp.date];
    maxSpentDate = exp.date;
  }
  daysWithExpenses.add(exp.date);
}

let numDays = allDates.size;
let avgSpent = numDays > 0 ? (totalSpent / numDays).toFixed(2) : 0;

// Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØªÙŠ Ù„Ù… ÙŠØµØ±Ù Ø¨Ù‡Ø§ Ø´ÙŠØ¡ (Ø¯Ø®Ù„ Ø¥Ø¶Ø§ÙÙŠ Ø£Ùˆ Ù„Ø§ Ø¯Ø®Ù„)
let zeroSpendDays = [];
for (let date in extras) {
  if (!daysWithExpenses.has(date)) zeroSpendDays.push(date);
}

document.getElementById("stats").innerHTML = `
  <hr><b>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ù†ÙØ§Ù‚:</b><br>
  ğŸ” Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…ÙØ³Ø¬Ù„: ${numDays} ÙŠÙˆÙ…<br>
  ğŸ§¾ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ: ${totalSpent.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±<br>
  ğŸ“‰ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${avgSpent} Ø¯ÙŠÙ†Ø§Ø±<br>
  ğŸ”¥ Ø£ÙƒØ«Ø± ÙŠÙˆÙ… Ø¥Ù†ÙØ§Ù‚Ù‹Ø§: ${maxSpentDate} (${maxSpent.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±)<br>
  âœ… Ø£ÙŠØ§Ù… Ø¨Ø¯ÙˆÙ† Ù…ØµØ±ÙˆÙ: ${zeroSpendDays.length} (${zeroSpendDays.join(", ")})
`;


    }

    function resetData() {
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
        localStorage.clear();
        location.reload();
      }
    }

    // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = updateUI;
  </script>
</body>
</html>
