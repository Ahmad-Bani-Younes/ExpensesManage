<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#4a6fa5" />
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø®ØµÙŠØ©</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #4a6fa5;
      --secondary-color: #166088;
      --accent-color: #4fc3f7;
      --success-color: #2e7d32;
      --warning-color: #ff8f00;
      --danger-color: #c62828;
      --light-color: #f8f9fa;
      --dark-color: #2c3e50;
      --text-color: #333;
      --border-radius: 12px;
      --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Tajawal', sans-serif;
      background-color: #f5f7fa;
      color: var(--text-color);
      line-height: 1.6;
      padding: 20px;
      direction: rtl;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px;
      position: relative;
      overflow: hidden;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100%;
      height: 8px;
      background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
    }
    
    h1 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 25px;
      font-weight: 700;
      font-size: 28px;
      position: relative;
      padding-bottom: 10px;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 50%;
      transform: translateX(50%);
      width: 80px;
      height: 3px;
      background: var(--accent-color);
      border-radius: 3px;
    }
    
    .section {
      margin-bottom: 25px;
      padding: 20px;
      background: var(--light-color);
      border-radius: var(--border-radius);
      border-left: 4px solid var(--primary-color);
    }
    
    .section-title {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      color: var(--primary-color);
      font-weight: 500;
    }
    
    .section-title i {
      margin-left: 8px;
      font-size: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark-color);
    }
    
    input {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-family: 'Tajawal', sans-serif;
      font-size: 16px;
      transition: var(--transition);
      margin-bottom: 15px;
    }
    
    input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.2);
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px;
      border-radius: var(--border-radius);
      font-family: 'Tajawal', sans-serif;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }
    
    button:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
    }
    
    button i {
      margin-left: 8px;
    }
    
    .btn-danger {
      background-color: var(--danger-color);
    }
    
    .btn-danger:hover {
      background-color: #b71c1c;
    }
    
    .btn-success {
      background-color: var(--success-color);
    }
    
    .btn-success:hover {
      background-color: #1b5e20;
    }
    
    .btn-info {
      background-color: var(--accent-color);
      color: var(--dark-color);
    }
    
    .btn-info:hover {
      background-color: #03a9f4;
    }
    
    .result-card {
      background: white;
      border-radius: var(--border-radius);
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: var(--box-shadow);
      border-top: 3px solid var(--primary-color);
    }
    
    .result-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px dashed #eee;
    }
    
    .result-item:last-child {
      border-bottom: none;
    }
    
    .alert {
      padding: 12px;
      border-radius: var(--border-radius);
      margin: 15px 0;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
    
    .alert-success {
      background-color: #e8f5e9;
      color: var(--success-color);
      border-right: 3px solid var(--success-color);
    }
    
    .alert-warning {
      background-color: #fff3e0;
      color: var(--warning-color);
      border-right: 3px solid var(--warning-color);
    }
    
    .alert-danger {
      background-color: #ffebee;
      color: var(--danger-color);
      border-right: 3px solid var(--danger-color);
    }
    
    .day-card {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: var(--box-shadow);
      border: 1px solid #eee;
    }
    
    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    
    .day-title {
      color: var(--primary-color);
      font-weight: 500;
    }
    
    .expense-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    .expense-actions button {
      background: none;
      border: none;
      color: var(--text-color);
      cursor: pointer;
      margin: 0 5px;
      width: auto;
      padding: 5px;
    }
    
    .expense-actions button:hover {
      transform: scale(1.1);
    }
    
    .day-summary {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed #ddd;
      font-size: 14px;
    }
    
    .stats-card {
      background: white;
      border-radius: var(--border-radius);
      padding: 15px;
      margin-top: 20px;
      box-shadow: var(--box-shadow);
    }
    
    .stat-item {
      margin-bottom: 10px;
    }
    
    small {
      display: block;
      text-align: center;
      margin-top: 15px;
      color: #777;
      font-size: 13px;
    }
    
    /* Modal Styles */
    #custom-modal {
      display: none;
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    
    #custom-modal-content {
      background-color: #fff;
      padding: 25px;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 400px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      text-align: center;
    }
    
    #custom-modal-message {
      font-size: 16px;
      margin-bottom: 20px;
      line-height: 1.6;
    }
    
    .modal-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    
    .modal-buttons button {
      flex: 1;
      margin: 0;
    }
    
    #edit-modal {
      display: none;
      position: fixed;
      inset: 0;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    
    .edit-modal-content {
      background: white;
      padding: 25px;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 400px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    
    .edit-modal-content h3 {
      color: var(--primary-color);
      margin-bottom: 20px;
      text-align: center;
    }
    
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 15px;
      }
      
      h1 {
        font-size: 24px;
      }
      
      .section {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h1>
    
    <div class="section">
      <div class="section-title">
        <i>ğŸ’°</i>
        <span>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
      </div>
      <label for="salary">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
      <input type="number" id="salary" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§ØªØ¨Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ">
      
      <label for="expenses">Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</label>
      <input type="number" id="expenses" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©">
      
      <button onclick="calculate()" class="btn-success">
        <i>ğŸ§®</i>
        <span>Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
      </button>
      
      <div id="settings-card"></div>
      <div id="result"></div>
    </div>
    
    <div class="section">
      <div class="section-title">
        <i>ğŸ’¸</i>
        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
      </div>
      
      <label for="extra-today">Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</label>
      <input type="number" id="extra-today" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ">
      <button onclick="addExtra()" class="btn-info">
        <i>â•</i>
        <span>Ø£Ø¶Ù Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</span>
      </button>
      
      <label for="daily-expense">Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…</label>
      <input type="number" id="daily-expense" placeholder="Ø£Ø¯Ø®Ù„ Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…">
      <button onclick="addExpense()" class="btn-info">
        <i>â•</i>
        <span>Ø£Ø¶Ù Ø§Ù„Ù…ØµØ±ÙˆÙ</span>
      </button>
      
      <div id="remaining"></div>
      <div id="expense-list"></div>
      <div id="stats"></div>
      
      <small>Ø³ÙŠØªÙ… Ø®ØµÙ… Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ù…ØµØ±ÙˆÙÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ ÙˆØªÙˆÙÙŠØ±Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</small>
    </div>
    
    <button id="restore-btn" onclick="restoreBackup()" class="btn-info" style="display:none;">
      <i>ğŸ”„</i>
      <span>Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¢Ø®Ø± Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ… Ø­Ø°ÙÙ‡Ø§</span>
    </button>
    
    <button onclick="resetData()" class="btn-danger">
      <i>â™»ï¸</i>
      <span>Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
    </button>
  </div>
  
  <!-- Modal Dialogs -->
  <div id="custom-modal">
    <div id="custom-modal-content">
      <p id="custom-modal-message"></p>
      <div class="modal-buttons">
        <button id="custom-modal-ok" class="btn-success">Ù…ÙˆØ§ÙÙ‚</button>
        <button id="custom-modal-cancel" class="btn-danger">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>
  
  <div id="edit-modal" class="modal">
    <div class="edit-modal-content">
      <h3>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
      <label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
      <input type="number" id="edit-salary" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
      <label>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
      <input type="number" id="edit-expenses" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
      <div class="modal-buttons">
        <button onclick="saveEdits()" class="btn-success">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
        <button onclick="closeEditModal()" class="btn-danger">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <script>
    // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØºÙŠÙŠØ±
    function getArabicDayName(dateString) {
      const days = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
      const d = new Date(dateString);
      if (isNaN(d.getDay())) return "â“";
      return days[d.getDay()];
    }

   function calculate(isUpdate = false) {
  const salary = parseFloat(document.getElementById("salary").value) || 0;
  const expenses = parseFloat(document.getElementById("expenses").value) || 0;

  localStorage.setItem("saved_salary", salary);
  localStorage.setItem("saved_expenses", expenses);

  const totalIncome = salary;
  const netBeforeSaving = totalIncome - expenses;

  let savingPercent = 0;
  if (netBeforeSaving < 100) savingPercent = 5;
  else if (netBeforeSaving < 200) savingPercent = 10;
  else if (netBeforeSaving < 400) savingPercent = 15;
  else savingPercent = 20;

  const savingAmount = (totalIncome * savingPercent / 100);
  const net = totalIncome - expenses - savingAmount;
  const daily = (net / 30).toFixed(2);

  localStorage.setItem("daily_limit", daily);
  localStorage.setItem("saving_plan", savingAmount.toFixed(2));
  localStorage.setItem("saving_percent", savingPercent);
  localStorage.setItem("last_date", new Date().toLocaleDateString());

  if (!isUpdate) {
    // ÙÙ‚Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
    localStorage.setItem("carry", "0");
    localStorage.setItem("expenses", JSON.stringify([]));
    localStorage.setItem("extra_income", JSON.stringify({}));
  }

  updateUI();
}


    function addExtra() {
      const amount = parseFloat(document.getElementById("extra-today").value);
      if (!amount || amount <= 0) return;

      const today = new Date().toISOString().split("T")[0];
      const todayName = getArabicDayName(today);
      let extras = JSON.parse(localStorage.getItem("extra_income")) || {};
      extras[today] = (extras[today] || 0) + amount;
      localStorage.setItem("extra_income", JSON.stringify(extras));

      document.getElementById("extra-today").value = "";
      updateUI();
    }

    function addExpense() {
      const amount = parseFloat(document.getElementById("daily-expense").value);
      if (!amount || amount <= 0) return;

      const today = new Date().toISOString().split("T")[0];
      let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
      expenses.push({ amount, date: today });
      localStorage.setItem("expenses", JSON.stringify(expenses));

      document.getElementById("daily-expense").value = "";
      updateUI();
    }

    function updateUI() {
      const today = new Date().toISOString().split("T")[0];
      const lastDate = localStorage.getItem("last_date");
      const dailyLimit = parseFloat(localStorage.getItem("daily_limit")) || 0;
      let carry = parseFloat(localStorage.getItem("carry")) || 0;
      let extras = JSON.parse(localStorage.getItem("extra_income")) || {};
      const extraToday = extras[today] || 0;

      const baseSaving = parseFloat(localStorage.getItem("saving_plan")) || 0;
      const dynamicSaving = (extraToday * (parseFloat(localStorage.getItem("saving_percent")) || 0) / 100).toFixed(2);
      const totalSaving = (baseSaving / 30 + parseFloat(dynamicSaving)).toFixed(2);
      const savingPercent = localStorage.getItem("saving_percent") || 0;

      let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

      if (lastDate && lastDate !== today) {
        const yesterdayExpenses = expenses.filter(e => e.date === lastDate);
        const spentYesterday = yesterdayExpenses.reduce((sum, e) => sum + e.amount, 0);
        const saved = Math.max(dailyLimit - spentYesterday, 0);
        carry += saved;
        localStorage.setItem("carry", carry.toFixed(2));
        localStorage.setItem("last_date", today);
      }

      const todayExpenses = expenses.filter(e => e.date === today);
      const totalSpentToday = todayExpenses.reduce((sum, e) => sum + e.amount, 0);
      const effectiveLimit = (dailyLimit + carry + extraToday).toFixed(2);
      const remainingToday = (effectiveLimit - totalSpentToday).toFixed(2);

      document.getElementById("result").innerHTML = `
        <div class="result-card">
          <div class="result-item">
            <span>Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„ÙŠÙˆÙ…:</span>
            <span><b>${effectiveLimit} Ø¯ÙŠÙ†Ø§Ø±</b></span>
          </div>
          <div class="result-item">
            <span>Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…:</span>
            <span>${extraToday} Ø¯ÙŠÙ†Ø§Ø±</span>
          </div>
          <div class="result-item">
            <span>Ø®Ø·Ø© Ø§Ù„ØªÙˆÙÙŠØ± (${savingPercent}%):</span>
            <span>${totalSaving} Ø¯ÙŠÙ†Ø§Ø±</span>
          </div>
        </div>
      `;

      let alertMessage = "";
      if (remainingToday < 0) {
        alertMessage = `
          <div class="alert alert-danger">
            âš ï¸ Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ù…Ù‚Ø¯Ø§Ø± ${Math.abs(remainingToday)} Ø¯ÙŠÙ†Ø§Ø±
          </div>
        `;
        if (Notification.permission === "granted") {
          new Notification(`âš ï¸ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù€ ${Math.abs(remainingToday)} Ø¯ÙŠÙ†Ø§Ø±`);
        }
      } else if (remainingToday > 0) {
        alertMessage = `
          <div class="alert alert-success">
            âœ… Ù…Ù…ØªØ§Ø²! ÙˆÙÙ‘Ø±Øª ${remainingToday} Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„ÙŠÙˆÙ…
          </div>
        `;
      }
      
      document.getElementById("remaining").innerHTML = `
        <div class="result-card">
          <div class="result-item">
            <span>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ÙŠÙˆÙ…:</span>
            <span><b>${remainingToday} Ø¯ÙŠÙ†Ø§Ø±</b></span>
          </div>
          ${alertMessage}
        </div>
      `;

      const grouped = {};
      expenses.forEach(e => {
        if (!grouped[e.date]) grouped[e.date] = [];
        grouped[e.date].push(e.amount);
      });

      const expenseContainer = document.getElementById("expense-list");
      expenseContainer.innerHTML = "";

      Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
        const card = document.createElement("div");
        card.className = "day-card";

        const header = document.createElement("div");
        header.className = "day-header";
        
        const title = document.createElement("div");
        title.className = "day-title";
        const dayName = getArabicDayName(date);
        title.textContent = `${dayName} - ${date}`;
        header.appendChild(title);
        card.appendChild(header);

        const total = grouped[date].reduce((a, b) => a + b, 0).toFixed(2);
        const extraForDay = extras[date] || 0;
        let baseLimit = parseFloat(localStorage.getItem("daily_limit")) || 0;
        const limitThatDay = (date === today) ? (baseLimit + extraForDay + carry) : (baseLimit + extraForDay);
        const remainingThatDay = (limitThatDay - total).toFixed(2);
        let alert = "";

        if (remainingThatDay < 0) {
          alert = `
            <div class="alert alert-warning">
              âš ï¸ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ù…Ù‚Ø¯Ø§Ø± ${Math.abs(remainingThatDay)} Ø¯ÙŠÙ†Ø§Ø±
            </div>
          `;
        } else if (remainingThatDay > 0) {
          alert = `
            <div class="alert alert-success">
              âœ… ÙˆÙÙ‘Ø±Øª ${remainingThatDay} Ø¯ÙŠÙ†Ø§Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…
            </div>
          `;
        }

        grouped[date].forEach((amt, i) => {
          const item = document.createElement("div");
          item.className = "expense-item";
          item.innerHTML = `
            <span>Ù…ØµØ±ÙˆÙ ${i + 1}: ${amt} Ø¯ÙŠÙ†Ø§Ø±</span>
            <div class="expense-actions">
              <button onclick="editExpense('${date}', ${i})">ğŸ“</button>
              <button onclick="deleteExpense('${date}', ${i})">ğŸ—‘ï¸</button>
            </div>
          `;
          card.appendChild(item);
        });

        const summary = document.createElement("div");
        summary.className = "day-summary";
        
        let extraInfo = "";
        if (extraForDay > 0) {
          extraInfo += `Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ: ${extraForDay} Ø¯ÙŠÙ†Ø§Ø±<br>`;
        }
        if (date === today && carry > 0) {
          extraInfo += `Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø­Ù„: ${carry.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±<br>`;
        }

        summary.innerHTML = `
          <div class="result-item">
            <span>Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…ØªØ§Ø­:</span>
            <span>${limitThatDay.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±</span>
          </div>
          <div class="result-item">
            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
            <span><b>${total} Ø¯ÙŠÙ†Ø§Ø±</b></span>
          </div>
          ${alert}
          <div style="margin-top:8px; color:#666; font-size:13px;">
            ${extraInfo}
          </div>
        `;

        card.appendChild(summary);
        expenseContainer.appendChild(card);
      });

      let allDates = new Set();
      let totalSpent = 0;
      let maxSpent = 0;
      let maxSpentDate = "";
      let daysWithExpenses = new Set();
      let savingsMap = {};

      for (let exp of expenses) {
        allDates.add(exp.date);
        totalSpent += exp.amount;
        if (!savingsMap[exp.date]) savingsMap[exp.date] = 0;
        savingsMap[exp.date] += exp.amount;
        if (savingsMap[exp.date] > maxSpent) {
          maxSpent = savingsMap[exp.date];
          maxSpentDate = exp.date;
        }
        daysWithExpenses.add(exp.date);
      }

      let numDays = allDates.size;
      let avgSpent = numDays > 0 ? (totalSpent / numDays).toFixed(2) : 0;
      let zeroSpendDays = [];
      for (let date in extras) {
        if (!daysWithExpenses.has(date)) zeroSpendDays.push(date);
      }

      document.getElementById("stats").innerHTML = `
        <div class="stats-card">
          <h3 class="section-title">
            <i>ğŸ“Š</i>
            <span>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ù†ÙØ§Ù‚</span>
          </h3>
          <div class="stat-item">
            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³Ø¬Ù„Ø©:</span>
            <span><b>${numDays} ÙŠÙˆÙ…</b></span>
          </div>
          <div class="stat-item">
            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ:</span>
            <span><b>${totalSpent.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±</b></span>
          </div>
          <div class="stat-item">
            <span>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ:</span>
            <span><b>${avgSpent} Ø¯ÙŠÙ†Ø§Ø±</b></span>
          </div>
          <div class="stat-item">
            <span>Ø£ÙƒØ«Ø± ÙŠÙˆÙ… Ø¥Ù†ÙØ§Ù‚Ù‹Ø§:</span>
            <span><b>${maxSpentDate} (${maxSpent.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±)</b></span>
          </div>
          <div class="stat-item">
            <span>Ø£ÙŠØ§Ù… Ø¨Ø¯ÙˆÙ† Ù…ØµØ±ÙˆÙ:</span>
            <span><b>${zeroSpendDays.length}</b></span>
          </div>
        </div>
      `;

      const salary = parseFloat(localStorage.getItem("saved_salary")) || 0;
      const expensesBase = parseFloat(localStorage.getItem("saved_expenses")) || 0;

      document.getElementById("settings-card").innerHTML = `
        <div class="result-card">
          <h3 class="section-title">
            <i>âš™ï¸</i>
            <span>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
          </h3>
          <div class="result-item">
            <span>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ:</span>
            <span><b>${salary} Ø¯ÙŠÙ†Ø§Ø±</b></span>
          </div>
          <div class="result-item">
            <span>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©:</span>
            <span><b>${expensesBase} Ø¯ÙŠÙ†Ø§Ø±</b></span>
          </div>
          <div style="display:flex; gap:10px; margin-top:15px;">
            <button onclick="editSettings()" class="btn-info" style="flex:1;">
              <i>âœï¸</i>
              <span>ØªØ¹Ø¯ÙŠÙ„</span>
            </button>
            <button onclick="deleteSettings()" class="btn-danger" style="flex:1;">
              <i>ğŸ—‘ï¸</i>
              <span>Ø­Ø°Ù</span>
            </button>
          </div>
        </div>
      `;
    }

    function editSettings() {
      document.getElementById("edit-salary").value = localStorage.getItem("saved_salary") || "";
      document.getElementById("edit-expenses").value = localStorage.getItem("saved_expenses") || "";
      document.getElementById("edit-modal").style.display = "flex";
    }

    function closeEditModal() {
      document.getElementById("edit-modal").style.display = "none";
    }

  function saveEdits() {
  const salary = parseFloat(document.getElementById("edit-salary").value);
  const expenses = parseFloat(document.getElementById("edit-expenses").value);
  if (!salary || salary <= 0 || isNaN(salary)) return alert("âŒ Ø£Ø¯Ø®Ù„ Ø±Ø§ØªØ¨ ØµØ§Ù„Ø­");
  if (expenses < 0 || isNaN(expenses)) return alert("âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ØµØ§Ù„Ø­Ø©");

  document.getElementById("salary").value = salary;
  document.getElementById("expenses").value = expenses;
  closeEditModal();
  calculate(true); // âœ… Ù†Ù…Ø±Ø± true Ø­ØªÙ‰ Ù„Ø§ ÙŠÙ…Ø³Ø­ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
}


    function deleteSettings() {
      showConfirmModal("ğŸ—‘ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø­Ø³Ø§Ø¨.", (confirmed) => {
        if (confirmed) {
          localStorage.removeItem("saved_salary");
          localStorage.removeItem("saved_expenses");
          location.reload();
        }
      });
    }

    function deleteExpense(date, index) {
      let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
      let filtered = [];
      let count = 0;
      for (let exp of expenses) {
        if (exp.date === date) {
          if (count === index) {
            count++;
            continue;
          }
          count++;
        }
        filtered.push(exp);
      }
      localStorage.setItem("expenses", JSON.stringify(filtered));
      updateUI();
    }

function editExpense(date, index) {
  showInputModal("ğŸ“ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…ØµØ±ÙˆÙ:", "", (newAmount) => {
    if (!newAmount || isNaN(newAmount) || newAmount <= 0) return;

    newAmount = parseFloat(newAmount);
    let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
    let count = 0;
    for (let i = 0; i < expenses.length; i++) {
      if (expenses[i].date === date) {
        if (count === index) {
          expenses[i].amount = newAmount;
          break;
        }
        count++;
      }
    }
    localStorage.setItem("expenses", JSON.stringify(expenses));
    updateUI();
  });
}


function showInputModal(message, defaultValue, onConfirm) {
  const modal = document.getElementById("custom-modal");
  const messageBox = document.getElementById("custom-modal-message");
  const okBtn = document.getElementById("custom-modal-ok");
  const cancelBtn = document.getElementById("custom-modal-cancel");

  // Ø£Ù†Ø´Ø¦ input Ø¯Ø§Ø®Ù„ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨ÙˆØ¨
  const inputField = document.createElement("input");
  inputField.type = "number";
  inputField.placeholder = "Ù…Ø«Ø§Ù„: 12";
  inputField.value = defaultValue || "";
  inputField.style.width = "100%";
  inputField.style.padding = "8px";
  inputField.style.marginTop = "10px";
  inputField.style.border = "1px solid #ccc";
  inputField.style.borderRadius = "6px";

  messageBox.innerHTML = message;
  messageBox.appendChild(inputField);

  modal.style.display = "flex";
  inputField.focus();

  const cleanup = () => {
    modal.style.display = "none";
    messageBox.innerHTML = "";
    okBtn.onclick = null;
    cancelBtn.onclick = null;
  };

  okBtn.onclick = () => {
    const val = inputField.value;
    cleanup();
    onConfirm(val);
  };

  cancelBtn.onclick = () => {
    cleanup();
  };
}


    function showConfirmModal(message, onConfirm) {
      const modal = document.getElementById("custom-modal");
      const messageBox = document.getElementById("custom-modal-message");
      const okBtn = document.getElementById("custom-modal-ok");
      const cancelBtn = document.getElementById("custom-modal-cancel");

      messageBox.textContent = message;
      modal.style.display = "flex";

      const cleanup = () => {
        modal.style.display = "none";
        okBtn.onclick = null;
        cancelBtn.onclick = null;
      };

      okBtn.onclick = () => {
        cleanup();
        onConfirm(true);
      };

      cancelBtn.onclick = () => {
        cleanup();
        onConfirm(false);
      };
    }

    function restoreBackup() {
      showConfirmModal("ğŸ“¦ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©ØŸ", (confirmed) => {
        if (!confirmed) return;

        const data = JSON.parse(localStorage.getItem("backup_data"));
        for (let key in data) {
          if (data[key]) localStorage.setItem(key, data[key]);
        }
        localStorage.removeItem("backup_data");
        location.reload();
      });
    }

    function resetData() {
      showConfirmModal("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ", (confirmed) => {
        if (confirmed) {
          const backup = {
            saved_salary: localStorage.getItem("saved_salary"),
            saved_expenses: localStorage.getItem("saved_expenses"),
            daily_limit: localStorage.getItem("daily_limit"),
            carry: localStorage.getItem("carry"),
            expenses: localStorage.getItem("expenses"),
            extra_income: localStorage.getItem("extra_income"),
            last_date: localStorage.getItem("last_date"),
            saving_plan: localStorage.getItem("saving_plan"),
            saving_percent: localStorage.getItem("saving_percent")
          };

          localStorage.clear();
          localStorage.setItem("backup_data", JSON.stringify(backup));
          location.reload();
        }
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (Notification.permission !== "granted") {
        Notification.requestPermission();
      }

      updateUI();
      document.getElementById("salary").value = localStorage.getItem("saved_salary") || "";
      document.getElementById("expenses").value = localStorage.getItem("saved_expenses") || "";

      if (localStorage.getItem("backup_data")) {
        document.getElementById("restore-btn").style.display = "block";
      }
    });
  </script>
</body>
</html>