<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- ØªØ­Ø³ÙŠÙ† ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
<meta name="theme-color" content="#f2f5f8" />


  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø®ØµÙŠØ©</title>
  <style>

#custom-modal {
  display: none; /* ğŸ‘ˆ Ø§Ø¬Ø¹Ù„Ù‡Ø§ None Ø¨Ø¯Ù„ Flex Ù‡Ù†Ø§ */
  position: fixed;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  background-color: rgba(0,0,0,0.4);
  justify-content: center;
  align-items: center;
  z-index: 9999;
}


#custom-modal-content {
  background-color: #fff;
  padding: 20px;
  border-radius: 12px;
  max-width: 90%;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  text-align: center;
}

#custom-modal-message {
  font-size: 16px;
  margin-bottom: 15px;
}

.modal-buttons {
  display: flex;
  justify-content: center;
  gap: 15px;
}

.modal-buttons button {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  font-size: 14px;
}

#custom-modal-ok {
  background-color: #27ae60;
  color: white;
}

#custom-modal-cancel {
  background-color: #e74c3c;
  color: white;
}

    body {
      font-family: 'Arial', sans-serif;
      background-color: #f2f5f8;
      padding: 20px;
      direction: rtl;
      text-align: right;
        word-wrap: break-word;

    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background-color: #27ae60;
      color: white;
      padding: 10px;
      width: 100%;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      margin-top: 15px;
      cursor: pointer;
    }
    button:hover {
      background-color: #219150;
    }
    .result, .summary {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
      color: #34495e;
      text-align: center;
    }
    .expenses-list {
      margin-top: 10px;
      font-size: 15px;
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
    }
    hr {
      border: 1px dashed #ccc;
      margin: 10px 0;
    }


    .day-card {
  background-color: #ffffff;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}
.day-card h3 {
  margin-bottom: 10px;
  color: #2980b9;
}
.expense-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #ecf0f1;
  padding: 6px 10px;
  border-radius: 6px;
  margin-bottom: 5px;
}
.expense-item button {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 14px;
}

@media (max-width: 480px) {
  body {
    padding: 10px;
  }
  .container {
    padding: 15px;
  }
  h1 {
    font-size: 20px;
  }
  button {
    font-size: 14px;
    padding: 8px;
  }
  .result, .summary {
    font-size: 16px;
  }
  .expense-item {
    flex-direction: column;
    align-items: flex-start;
  }
}

.modal {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: rgba(0,0,0,0.4);
  z-index: 9999;
}

.modal-content {
  background: white;
  padding: 20px;
  border-radius: 12px;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  text-align: center;
}

.modal-content input {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 6px;
}


  </style>
</head>
<body>
  <h1>ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h1>
  <div class="container">

    <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <label for="salary">ğŸ’° Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
    <input type="number" id="salary" placeholder="Ù…Ø«Ø§Ù„: 700" />


    <!-- <label for="extra">ğŸ’¼ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</label>
    <input type="number" id="extra" placeholder="Ù…Ø«Ø§Ù„: 150" /> -->

    <label for="expenses">ğŸ“‹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</label>
    <input type="number" id="expenses" placeholder="Ù…Ø«Ø§Ù„: 300" />



    <button onclick="calculate()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
    <div id="settings-card" style="margin-top:20px;"></div>
    <div class="result" id="result"></div>

    <!-- Ø¥Ø¯Ø®Ø§Ù„ Ù…ØµØ±ÙˆÙ ÙŠÙˆÙ…ÙŠ -->
    <hr />

    <label for="extra-today">ğŸ’¼ Ø¯Ø®Ù„ Ø¥Ø¶Ø§ÙÙŠ Ø§Ù„ÙŠÙˆÙ…</label>
<input type="number" id="extra-today" placeholder="Ù…Ø«Ø§Ù„: 5" />
<button onclick="addExtra()">Ø£Ø¶Ù Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</button>

    <label for="daily-expense">ğŸ’¸ Ø£Ø¶Ù Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…</label>
    <input type="number" id="daily-expense" placeholder="Ù…Ø«Ø§Ù„: 20" />
    <button onclick="addExpense()">Ø£Ø¶Ù Ø§Ù„Ù…ØµØ±ÙˆÙ</button>

    <div class="summary" id="remaining"></div>

    <!-- Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
    <div class="expenses-list" id="expense-list"></div>

    <div class="expenses-list" id="stats"></div>


    <small>Ø³ÙŠØªÙ… Ø®ØµÙ… Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ù…ØµØ±ÙˆÙÙƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ ÙˆØªÙˆÙÙŠØ±Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</small>


    <button id="restore-btn" onclick="restoreBackup()" style="
  display:none;
  background-color: #3498db;
  color: white;
  padding: 10px;
  width: 100%;
  border: none;
  border-radius: 6px;
  font-size: 16px;
  margin-top: 15px;
  cursor: pointer;
">
ğŸ“¦ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¢Ø®Ø± Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ… Ø­Ø°ÙÙ‡Ø§
</button>

    <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© -->
    <button style="background-color: #e74c3c;" onclick="resetData()">â™»ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

  </div>

    <div id="custom-modal">
  <div id="custom-modal-content">
    <p id="custom-modal-message"></p>
    <div class="modal-buttons">
      <button id="custom-modal-ok">Ù…ÙˆØ§ÙÙ‚</button>
      <button id="custom-modal-cancel">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
<div id="edit-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <h3>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
    <label>ğŸ’° Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
    <input type="number" id="edit-salary" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
    <label>ğŸ“‹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
    <input type="number" id="edit-expenses" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
    <div class="modal-buttons">
      <button onclick="saveEdits()">ğŸ’¾ Ø­ÙØ¸</button>
      <button onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>


  <script>

function getArabicDayName(dateString) {
  const days = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];

  // Ø§Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© Date Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ø¨Ø¯ÙˆÙ† split
  const d = new Date(dateString);
  if (isNaN(d.getDay())) return "â“"; // Ø§Ø­ØªÙŠØ§Ø· Ù„Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­

  return days[d.getDay()];
}





function calculate() {
  const salary = parseFloat(document.getElementById("salary").value) || 0;
  const expenses = parseFloat(document.getElementById("expenses").value) || 0;

  localStorage.setItem("saved_salary", salary);
  localStorage.setItem("saved_expenses", expenses);

// const goal = parseFloat(document.getElementById("monthly-goal").value) || 0;
// localStorage.setItem("saving_goal", goal);

  const totalIncome = salary;
  const netBeforeSaving = totalIncome - expenses;

  let savingPercent = 0;
  if (netBeforeSaving < 100) savingPercent = 5;
  else if (netBeforeSaving < 200) savingPercent = 10;
  else if (netBeforeSaving < 400) savingPercent = 15;
  else savingPercent = 20;

  const savingAmount = (totalIncome * savingPercent / 100);
  const net = totalIncome - expenses - savingAmount;
  const daily = (net / 30).toFixed(2);

  localStorage.setItem("daily_limit", daily);
  localStorage.setItem("carry", "0");
  localStorage.setItem("expenses", JSON.stringify([]));
  localStorage.setItem("extra_income", JSON.stringify({})); // Reset daily extras
  localStorage.setItem("last_date", new Date().toLocaleDateString());
  localStorage.setItem("saving_plan", savingAmount.toFixed(2));
  localStorage.setItem("saving_percent", savingPercent);


  


  updateUI();
}


function addExtra() {
  const amount = parseFloat(document.getElementById("extra-today").value);
  if (!amount || amount <= 0) return;

  const today = new Date().toISOString().split("T")[0]; // ÙŠØ¹Ø·ÙŠÙƒ YYYY-MM-DD Ø¨Ø´ÙƒÙ„ Ù…Ø¶Ù…ÙˆÙ†
  const todayName = getArabicDayName(today);
  let extras = JSON.parse(localStorage.getItem("extra_income")) || {};
  extras[today] = (extras[today] || 0) + amount;
  localStorage.setItem("extra_income", JSON.stringify(extras));

  document.getElementById("extra-today").value = "";
  updateUI();
}




    function addExpense() {
      const amount = parseFloat(document.getElementById("daily-expense").value);
      if (!amount || amount <= 0) return;

      const today = new Date().toISOString().split("T")[0]; // ÙŠØ¹Ø·ÙŠÙƒ YYYY-MM-DD Ø¨Ø´ÙƒÙ„ Ù…Ø¶Ù…ÙˆÙ†
      let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
      expenses.push({ amount, date: today });
      localStorage.setItem("expenses", JSON.stringify(expenses));

      document.getElementById("daily-expense").value = "";
      updateUI();
    }

    function updateUI() {
      const today = new Date().toISOString().split("T")[0]; // ÙŠØ¹Ø·ÙŠÙƒ YYYY-MM-DD Ø¨Ø´ÙƒÙ„ Ù…Ø¶Ù…ÙˆÙ†
      const lastDate = localStorage.getItem("last_date");
      const dailyLimit = parseFloat(localStorage.getItem("daily_limit")) || 0;
      let carry = parseFloat(localStorage.getItem("carry")) || 0;
      let extras = JSON.parse(localStorage.getItem("extra_income")) || {};
const extraToday = extras[today] || 0;


const baseSaving = parseFloat(localStorage.getItem("saving_plan")) || 0;
const dynamicSaving = (extraToday * (parseFloat(localStorage.getItem("saving_percent")) || 0) / 100).toFixed(2);
const totalSaving = (baseSaving / 30 + parseFloat(dynamicSaving)).toFixed(2);
const savingPercent = localStorage.getItem("saving_percent") || 0;


      let expenses = JSON.parse(localStorage.getItem("expenses")) || [];

      // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØºÙŠÙŠØ± Ø§Ù„ÙŠÙˆÙ… Ù„ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯
      if (lastDate && lastDate !== today) {
        const yesterdayExpenses = expenses.filter(e => e.date === lastDate);
        const spentYesterday = yesterdayExpenses.reduce((sum, e) => sum + e.amount, 0);
        const saved = Math.max(dailyLimit - spentYesterday, 0);
        carry += saved;
        localStorage.setItem("carry", carry.toFixed(2));
        localStorage.setItem("last_date", today);
      }

      const todayExpenses = expenses.filter(e => e.date === today);
      const totalSpentToday = todayExpenses.reduce((sum, e) => sum + e.amount, 0);
const effectiveLimit = (dailyLimit + carry + extraToday).toFixed(2);
      const remainingToday = (effectiveLimit - totalSpentToday).toFixed(2);

document.getElementById("result").innerHTML = `
  <div style="background:#e8f5e9; border-radius:8px; padding:10px; margin-bottom:10px; color:#2e7d32;">
    âœ… <b>Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„ÙŠÙˆÙ…:</b> ${effectiveLimit} Ø¯ÙŠÙ†Ø§Ø±<br>
    <small>(ÙŠØ´Ù…Ù„: Ø§Ù„Ù…Ø±Ø­Ù„ + Ø¯Ø®Ù„ Ø¥Ø¶Ø§ÙÙŠ ${extraToday})</small>
  </div>
  <div style="background:#e3f2fd; border-radius:8px; padding:10px; margin-bottom:10px; color:#1565c0;">
    ğŸ¦ <b>Ø®Ø·Ø© Ø§Ù„ØªÙˆÙÙŠØ± (${savingPercent}%):</b><br>
    ğŸ’° Ù…Ù† Ø§Ù„Ø±Ø§ØªØ¨: ${baseSaving} Ø¯ÙŠÙ†Ø§Ø±<br>
    ğŸ’¼ Ù…Ù† Ø¯Ø®Ù„ Ø§Ù„ÙŠÙˆÙ…: ${dynamicSaving} Ø¯ÙŠÙ†Ø§Ø±
  </div>
  <div style="background:#fce4ec; border-radius:8px; padding:10px; color:#ad1457;">
    ğŸ <b>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø®ØµÙˆÙ… Ù„Ù„ØªÙˆÙÙŠØ±:</b> ${totalSaving} Ø¯ÙŠÙ†Ø§Ø± Ù…Ù† Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…
  </div>
`;


      document.getElementById("remaining").innerText = `ğŸ’° Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ÙŠÙˆÙ…: ${remainingToday} Ø¯ÙŠÙ†Ø§Ø±`;

let alertMessage = "";
if (remainingToday < 0) {
  alertMessage = `
    <div style="
      background-color: #fdecea;
      color: #c0392b;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      font-weight: bold;
      font-size: 15px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    ">
      âš ï¸ Ù„Ù‚Ø¯ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ù…Ù‚Ø¯Ø§Ø± ${Math.abs(remainingToday)} Ø¯ÙŠÙ†Ø§Ø±
    </div>
  `;
  if (Notification.permission === "granted") {
    new Notification(`âš ï¸ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù€ ${Math.abs(remainingToday)} Ø¯ÙŠÙ†Ø§Ø±`);
  }
} else if (remainingToday > 0) {
  alertMessage = `
    <div style="
      background-color: #e8f5e9;
      color: #2e7d32;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      font-weight: bold;
      font-size: 15px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    ">
      âœ… Ù…Ù…ØªØ§Ø²! ÙˆÙÙ‘Ø±Øª ${remainingToday} Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„ÙŠÙˆÙ…
    </div>
  `;
}
document.getElementById("remaining").innerHTML += alertMessage;



      // Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ù…ÙØµÙˆÙ„Ø© Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…
      const grouped = {};
      expenses.forEach(e => {
        if (!grouped[e.date]) grouped[e.date] = [];
        grouped[e.date].push(e.amount);
      });

const expenseContainer = document.getElementById("expense-list");
expenseContainer.innerHTML = ""; // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ…


Object.keys(grouped).sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
  const card = document.createElement("div");
card.className = "day-card";

const title = document.createElement("h3");
const dayName = getArabicDayName(date);
title.textContent = `ğŸ“… ${dayName} - ${date}`;
card.appendChild(title);



   const total = grouped[date].reduce((a, b) => a + b, 0).toFixed(2);

  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ø°Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ…
  const extraForDay = extras[date] || 0;
  let baseLimit = parseFloat(localStorage.getItem("daily_limit")) || 0;

  // Ø§ÙØªØ±Ø§Ø¶ Ø£Ù† Ø§Ù„Ø­Ù…Ù„ ÙŠÙ†Ø·Ø¨Ù‚ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØŒ ÙÙ†ØªØ±ÙƒÙ‡
  const limitThatDay = (date === today) ? (baseLimit + extraForDay + carry) : (baseLimit + extraForDay);

  const remainingThatDay = (limitThatDay - total).toFixed(2);
  let alert = "";


if (remainingThatDay < 0) {
  alert = `
    <div style="
      background-color: #fdecea;
      color: #c0392b;
      padding: 6px;
      border-radius: 6px;
      margin-top: 6px;
      font-size: 14px;
    ">
      âš ï¸ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ù…Ù‚Ø¯Ø§Ø± ${Math.abs(remainingThatDay)} Ø¯ÙŠÙ†Ø§Ø±
    </div>
  `;
} else if (remainingThatDay > 0) {
  alert = `
    <div style="
      background-color: #e8f5e9;
      color: #2e7d32;
      padding: 6px;
      border-radius: 6px;
      margin-top: 6px;
      font-size: 14px;
    ">
      âœ… ÙˆÙÙ‘Ø±Øª ${remainingThatDay} Ø¯ÙŠÙ†Ø§Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…
    </div>
  `;
}




  grouped[date].forEach((amt, i) => {
    const item = document.createElement("div");
    item.className = "expense-item";
    item.innerHTML = `
      ğŸ§¾ Ù…ØµØ±ÙˆÙ ${i + 1}: -${amt} Ø¯ÙŠÙ†Ø§Ø±
      <span>
        <button onclick="editExpense('${date}', ${i})">ğŸ“</button>
        <button onclick="deleteExpense('${date}', ${i})">ğŸ—‘ï¸</button>
      </span>
    `;
    card.appendChild(item);
  });

const totalRow = document.createElement("div");
totalRow.style.marginTop = "8px";

let extraInfo = "";
if (extraForDay > 0) {
  extraInfo += `ğŸ’¼ Ø¯Ø®Ù„ Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…: ${extraForDay} Ø¯ÙŠÙ†Ø§Ø±<br>`;
}
if (date === today && carry > 0) {
  extraInfo += `ğŸ” Ù…Ø¨Ù„Øº Ù…Ø±Ø­Ù„: ${carry.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±<br>`;
}


const effectiveLimitThatDay = limitThatDay.toFixed(2);

totalRow.innerHTML = `
  <div style="margin-bottom:5px; font-size:14px; color:#2c3e50;">
    ğŸ’° <b>Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…ØªØ§Ø­ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…:</b> ${effectiveLimitThatDay} Ø¯ÙŠÙ†Ø§Ø±
  </div>
  ğŸ”¢ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ…: <b>${total} Ø¯ÙŠÙ†Ø§Ø±</b> ${alert}
  <div style="margin-top:5px; font-size:14px; color:#555;">
    ${extraInfo}
  </div>
`;

  card.appendChild(totalRow);


  expenseContainer.appendChild(card);
});


// // ğŸ“Š Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø°ÙƒÙŠØ©
// let allDates = new Set();
// let totalSpent = 0;
// let maxSpent = 0;
// let maxSpentDate = "";
// let daysWithExpenses = new Set();

// for (let exp of allExpenses) {
//   allDates.add(exp.date);
//   totalSpent += exp.amount;
//   if (!savingsMap[exp.date]) savingsMap[exp.date] = 0;
//   savingsMap[exp.date] += exp.amount;
//   if (savingsMap[exp.date] > maxSpent) {
//     maxSpent = savingsMap[exp.date];
//     maxSpentDate = exp.date;
//   }
//   daysWithExpenses.add(exp.date);
// }


let allDates = new Set();
let totalSpent = 0;
let maxSpent = 0;
let maxSpentDate = "";
let daysWithExpenses = new Set();
let savingsMap = {};

for (let exp of expenses) {
  allDates.add(exp.date);
  totalSpent += exp.amount;
  if (!savingsMap[exp.date]) savingsMap[exp.date] = 0;
  savingsMap[exp.date] += exp.amount;
  if (savingsMap[exp.date] > maxSpent) {
    maxSpent = savingsMap[exp.date];
    maxSpentDate = exp.date;
  }
  daysWithExpenses.add(exp.date);
}



let numDays = allDates.size;
let avgSpent = numDays > 0 ? (totalSpent / numDays).toFixed(2) : 0;

// Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ØªÙŠ Ù„Ù… ÙŠØµØ±Ù Ø¨Ù‡Ø§ Ø´ÙŠØ¡ (Ø¯Ø®Ù„ Ø¥Ø¶Ø§ÙÙŠ Ø£Ùˆ Ù„Ø§ Ø¯Ø®Ù„)
let zeroSpendDays = [];
for (let date in extras) {
  if (!daysWithExpenses.has(date)) zeroSpendDays.push(date);
}

document.getElementById("stats").innerHTML = `
  <hr><b>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ù†ÙØ§Ù‚:</b><br>
  ğŸ” Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØµØ±ÙˆÙ Ø§Ù„Ù…ÙØ³Ø¬Ù„: ${numDays} ÙŠÙˆÙ…<br>
  ğŸ§¾ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ: ${totalSpent.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±<br>
  ğŸ“‰ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${avgSpent} Ø¯ÙŠÙ†Ø§Ø±<br>
  ğŸ”¥ Ø£ÙƒØ«Ø± ÙŠÙˆÙ… Ø¥Ù†ÙØ§Ù‚Ù‹Ø§: ${maxSpentDate} (${maxSpent.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±)<br>
  âœ… Ø£ÙŠØ§Ù… Ø¨Ø¯ÙˆÙ† Ù…ØµØ±ÙˆÙ: ${zeroSpendDays.length} (${zeroSpendDays.join(", ")})
`;


const salary = parseFloat(localStorage.getItem("saved_salary")) || 0;
const expensesBase = parseFloat(localStorage.getItem("saved_expenses")) || 0;

document.getElementById("settings-card").innerHTML = `
  <div style="background:#fff3e0; border-radius:8px; padding:12px; margin-top:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
    <b>âš™ï¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:</b><br><br>
    ğŸ’° <b>Ø§Ù„Ø±Ø§ØªØ¨:</b> ${salary} Ø¯ÙŠÙ†Ø§Ø±<br>
    ğŸ“‹ <b>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª:</b> ${expensesBase} Ø¯ÙŠÙ†Ø§Ø±<br><br>
    <div style="display:flex; gap:10px; flex-direction:column; margin-top:10px;">
  <button onclick="editSettings()" style="
    background: linear-gradient(to right, #3498db, #2980b9);
    color: white;
    border: none;
    padding: 10px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s ease;
  ">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

  <button onclick="deleteSettings()" style="
    background: linear-gradient(to right, #e74c3c, #c0392b);
    color: white;
    border: none;
    padding: 10px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s ease;
  ">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
</div>

  </div>
`;


    }



    function editSettings() {
  const newSalary = prompt("ğŸ’° Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯:", localStorage.getItem("saved_salary"));
  const newExpenses = prompt("ğŸ“‹ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:", localStorage.getItem("saved_expenses"));
  
  if (!newSalary || isNaN(newSalary) || newSalary <= 0) return;
  if (!newExpenses || isNaN(newExpenses) || newExpenses < 0) return;

  document.getElementById("salary").value = newSalary;
  document.getElementById("expenses").value = newExpenses;
  calculate(); // ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ†
}

function deleteSettings() {
  showConfirmModal("ğŸ—‘ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø­Ø³Ø§Ø¨.", (confirmed) => {
    if (confirmed) {
      localStorage.removeItem("saved_salary");
      localStorage.removeItem("saved_expenses");
      location.reload();
    }
  });
}


    function deleteExpense(date, index) {
  let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
  // Ø§Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
  let filtered = [];
  let count = 0;
  for (let exp of expenses) {
    if (exp.date === date) {
      if (count === index) {
        count++;
        continue; // Ø§Ø­Ø°Ù Ù‡Ø°Ø§
      }
      count++;
    }
    filtered.push(exp);
  }
  localStorage.setItem("expenses", JSON.stringify(filtered));
  updateUI();
}

function editSettings() {
  document.getElementById("edit-salary").value = localStorage.getItem("saved_salary") || "";
  document.getElementById("edit-expenses").value = localStorage.getItem("saved_expenses") || "";
  document.getElementById("edit-modal").style.display = "flex";
}

function closeEditModal() {
  document.getElementById("edit-modal").style.display = "none";
}

function saveEdits() {
  const salary = parseFloat(document.getElementById("edit-salary").value);
  const expenses = parseFloat(document.getElementById("edit-expenses").value);
  if (!salary || salary <= 0 || isNaN(salary)) return alert("âŒ Ø£Ø¯Ø®Ù„ Ø±Ø§ØªØ¨ ØµØ§Ù„Ø­");
  if (expenses < 0 || isNaN(expenses)) return alert("âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ØµØ§Ù„Ø­Ø©");

  document.getElementById("salary").value = salary;
  document.getElementById("expenses").value = expenses;
  closeEditModal();
  calculate();
}


function editExpense(date, index) {
  let newAmount = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:");
  if (!newAmount || isNaN(newAmount) || newAmount <= 0) return;

  newAmount = parseFloat(newAmount);
  let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
  let count = 0;
  for (let i = 0; i < expenses.length; i++) {
    if (expenses[i].date === date) {
      if (count === index) {
        expenses[i].amount = newAmount;
        break;
      }
      count++;
    }
  }
  localStorage.setItem("expenses", JSON.stringify(expenses));
  updateUI();
}

function showConfirmModal(message, onConfirm) {
  const modal = document.getElementById("custom-modal");
  const messageBox = document.getElementById("custom-modal-message");
  const okBtn = document.getElementById("custom-modal-ok");
  const cancelBtn = document.getElementById("custom-modal-cancel");

  messageBox.textContent = message;
  modal.style.display = "flex";

  const cleanup = () => {
    modal.style.display = "none";
    okBtn.onclick = null;
    cancelBtn.onclick = null;
  };

  okBtn.onclick = () => {
    cleanup();
    onConfirm(true);
  };

  cancelBtn.onclick = () => {
    cleanup();
    onConfirm(false);
  };
}


function restoreBackup() {
  showConfirmModal("ğŸ“¦ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©ØŸ", (confirmed) => {
    if (!confirmed) return;

    const data = JSON.parse(localStorage.getItem("backup_data"));
    for (let key in data) {
      if (data[key]) localStorage.setItem(key, data[key]);
    }
    localStorage.removeItem("backup_data");
    location.reload();
  });
}



   function resetData() {
  showConfirmModal("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ", (confirmed) => {
    if (confirmed) {
      const backup = {
        saved_salary: localStorage.getItem("saved_salary"),
        saved_expenses: localStorage.getItem("saved_expenses"),
        daily_limit: localStorage.getItem("daily_limit"),
        carry: localStorage.getItem("carry"),
        expenses: localStorage.getItem("expenses"),
        extra_income: localStorage.getItem("extra_income"),
        last_date: localStorage.getItem("last_date"),
        saving_plan: localStorage.getItem("saving_plan"),
        saving_percent: localStorage.getItem("saving_percent")
      };

      localStorage.clear();
      localStorage.setItem("backup_data", JSON.stringify(backup));
      location.reload();
    }
  });
}


document.addEventListener("DOMContentLoaded", () => {
 if (Notification.permission !== "granted") {
  Notification.requestPermission();
}

  updateUI();
  document.getElementById("salary").value = localStorage.getItem("saved_salary") || "";
  document.getElementById("expenses").value = localStorage.getItem("saved_expenses") || "";

  // Ø¹Ø±Ø¶ Ø§Ù„Ø²Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
  if (localStorage.getItem("backup_data")) {
    document.getElementById("restore-btn").style.display = "block";
  }
});


//     document.getElementById("salary").value = localStorage.getItem("saved_salary") || "";
// document.getElementById("expenses").value = localStorage.getItem("saved_expenses") || "";

  </script>




</body>
</html>
